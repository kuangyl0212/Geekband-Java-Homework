# 第八周作业

**1. 案例 01- 读已提交 RC 隔离级别下的可见性分析**

- 目标
  - 熟悉读已提交 RC 隔离级别下的可见性
- 操作步骤

| 事务A                                                   | 事务B                                                   |
| ------------------------------------------------------- | ------------------------------------------------------- |
| SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; | SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; |
| start transaction;                                      | start transaction;                                      |
| select * from t1 where id = 1;                          |                                                         |
|                                                         | update t1 set a = 2 where id = 1;                       |
| select * from t1 where id = 1;                          |                                                         |
|                                                         | commit;                                                 |
| select * from t1 where id = 1;                          |                                                         |
| commit;                                                 |                                                         |

* 实践过程

   1. 新建表并插入一行数据

      ```sql
      CREATE TABLE T1 (id int(10) unsigned auto_increment primary key, a int(10));
      INSERT INTO	T1 (1, 1);
      ```

  2. 打开两个session，并设置隔离级别为Read Committed

     ```
     SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
     ```

  3. 手动开启事务

  4. 事务A查询t1中id=1的数据，结果如下：

     ```
     mysql> select * from t1 where id = 1;
     +----+------+
     | id | a    |
     +----+------+
     |  1 |    1 |
     +----+------+
     1 row in set (0.00 sec)
     ```

  5. 事务B修改id = 1的数据的a为2

     ```
      update t1 set a = 2 where id = 1;
     ```

  6. 事务A再次读取id = 1的数据，结果的a仍然为1

     ```
     mysql> select * from t1 where id = 1;
     +----+------+
     | id | a    |
     +----+------+
     |  1 |    1 |
     +----+------+
     1 row in set (0.00 sec)
     ```

  7. 事务B提交

  8. 事务A再次读取，此时可以读到事务B的更新

     ```
     mysql> select * from t1 where id = 1;
     +----+------+
     | id | a    |
     +----+------+
     |  1 |    2 |
     +----+------+
     1 row in set (0.00 sec)
     ```

* 结论

  读已提交隔离级别下，一个事务只能读取到其他事务已提交的修改

  读已提交的隔离级别下会出现：不可重复读的问题（一个事务内，连续两次读取同样的数据，读到的结果是不一样的，原因是可以读到其他事务的对已有数据的更新）和幻读问题（会读到其他事务提交的新插入或删除掉的数据）
